<html>

<head>
    <script>

        // copied from Google Analytics Snippet, adapted for Prometheus Aggregator
        (function(i,s,o,g,r,a,m){i['PrometheusAggregatorObjectName']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=(g+'/static/aggregatorClient.js');m.parentNode.insertBefore(a,m);
        i[r].aggregatorServerRoot = g;
        })(window,document,'script','http://localhost:3000','prometheusAggregator');

        prometheusAggregator('increment', 'app_load_succeeded', { app: 'student'}, 1);

    </script>

</head>

<body>
    <h1>Super-simple demo</h1>
    <ol>
        <li>Click <button id='simulateUsage'>Simulate Usage</button> to simulate some client-side behavior</li>
        <li>Wait about 20s and then click "Execute" below (actually I just pound Execute until the change shows up)</li>
    </ol>

    
    <iframe src="http://localhost:9090/graph?g0.range_input=5m&g0.expr=usage_total&g0.tab=0" style="position: absolute; left: 5%; top: 30%; width: 90%; height: 70%">
    </iframe>
    <script>

        document.getElementById('simulateUsage').addEventListener('click', () => {
            prometheusAggregator('increment', 'usage_total', { browser: 'chrome', feature: 'quickQuestion' }, 1);
            prometheusAggregator('increment', 'usage_total', { browser: 'chrome', feature: 'quickQuestion' }, 1);
            prometheusAggregator('increment', 'usage_total', { browser: 'safari', feature: 'quickQuestion' }, 1);

            prometheusAggregator('observe', 'firebase_response_time', { firebaseHost: 'pd-dev-1.firebaseio.com'}, Math.random());
        });
    </script>
</body>

</html>